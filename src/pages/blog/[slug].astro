---
import Layout from '../../components/Layout.astro';
import Markdown from '../../components/Markdown.astro';

// Define getStaticPaths function
export async function getStaticPaths() {
    // The path should be './posts/*.md' based on your directory structure
    const allPosts = await Astro.glob('./posts/*.md'); 

    const paths = allPosts.map((post) => ({
        params: { slug: post.frontmatter.slug },
    }));

    return paths;
}

// The same path adjustment needs to be made here
const allPosts = await Astro.glob('./posts/*.md'); 
const post = allPosts.find(p => p.frontmatter.slug === Astro.params.slug);

// Set title using a let binding (this lets us use Astro's top-level await)
let title = 'Post Not Found';
if (post) {
  title = post.frontmatter.title;
}
---

<Layout title={title}>
  <article>
    {post ? (
      <>
        <h1>{post.frontmatter.title}</h1>
        <p>Published on: {new Date(post.frontmatter.date).toLocaleDateString()}</p>
        <Markdown content={post.rawContent} />
      </>
    ) : (
      <p>Sorry, the post you're looking for doesn't exist or may have been moved.</p>
    )}
  </article>
</Layout>